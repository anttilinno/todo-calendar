# Milestone v1.6: Templates & Recurring

**Status:** SHIPPED 2026-02-07
**Phases:** 20-22
**Total Plans:** 8

## Overview

Users can manage templates in a dedicated overlay and attach recurring schedules that auto-create todos on app launch.

## Phases

### Phase 20: Template Management Overlay

**Goal**: Users can browse, view, edit, rename, and delete templates in a dedicated full-screen overlay
**Depends on**: Phase 19
**Requirements**: REQ-20, REQ-21, REQ-22, REQ-23, REQ-24, REQ-25
**Success Criteria**:
  1. User can press M in normal mode to open a full-screen template list with cursor navigation
  2. Selecting a template shows its raw content (including placeholder syntax) below the list
  3. User can delete a template with d, rename with r (pre-filled input, duplicate name handled), and edit content with e (opens external editor)
  4. Esc closes the overlay and returns to the main view
**Risk**: LOW -- follows established overlay pattern (settings, search, preview)
**Plans**: 2 plans

Plans:
- [x] 20-01-PLAN.md -- Store extension (UpdateTemplate) and tmplmgr overlay package
- [x] 20-02-PLAN.md -- Wire overlay into app.Model with external editor integration

### Phase 21: Schedule Schema & CRUD

**Goal**: The data layer supports recurring schedule definitions attached to templates with deduplication tracking
**Depends on**: Phase 20
**Requirements**: REQ-26, REQ-27, REQ-28
**Success Criteria**:
  1. Migration v4 creates a schedules table with FK CASCADE to templates and columns for cadence_type, cadence_value, and placeholder_defaults (JSON)
  2. Migration v5 adds schedule_id (FK SET NULL) and schedule_date columns to todos table with a unique index for deduplication
  3. ScheduleRule in internal/recurring can parse and match all four cadence types (daily, weekdays, weekly, monthly) including monthly day clamping for short months
  4. TodoStore interface has schedule CRUD methods (Add/List/Delete/Update) plus TodoExistsForSchedule and AddScheduledTodo, implemented in SQLite and stubbed in JSON store
**Risk**: MEDIUM -- schema design is straightforward but monthly edge cases and migration ordering need careful testing
**Plans**: 2 plans

Plans:
- [x] 21-01-PLAN.md -- ScheduleRule TDD (parse/match all cadence types in internal/recurring)
- [x] 21-02-PLAN.md -- Schedule struct, migrations v4+v5, interface extension, SQLite CRUD

### Phase 22: Auto-Creation & Schedule UI

**Goal**: Scheduled todos are automatically created on app launch and users can attach/manage schedules from the template overlay
**Depends on**: Phase 21
**Requirements**: REQ-29, REQ-30, REQ-31, REQ-32, REQ-33
**Success Criteria**:
  1. User can press S on a template in the overlay to open a schedule picker that cycles cadence types with arrows, toggles weekdays with space, and accepts a day number for monthly
  2. Templates with schedules show a dimmed suffix in the overlay list (e.g., "(daily)", "(Mon/Wed/Fri)", "(15th of month)")
  3. On app launch, recurring.AutoCreate() runs in main.go before the TUI starts, creating todos for matching dates in a rolling 7-day window with deduplication
  4. Auto-created todos display an [R] indicator after the todo text, styled in a muted color
  5. When scheduling a template with placeholders, the user is prompted to fill default values once; auto-created todos use these stored defaults
**Risk**: HIGH -- integrates phases 20 and 21, schedule picker adds multiple sub-modes, placeholder defaults need a prompting sub-flow
**Plans**: 4 plans

Plans:
- [x] 22-01-PLAN.md -- AutoCreate engine TDD (generate scheduled todos with dedup and placeholder fill)
- [x] 22-02-PLAN.md -- Visual indicators ([R] on todos, schedule suffix on templates)
- [x] 22-03-PLAN.md -- Schedule picker UI with cadence cycling and weekday/monthly input
- [x] 22-04-PLAN.md -- Placeholder defaults prompting at schedule creation

## Requirement Coverage

| REQ | Phase | Description |
|-----|-------|-------------|
| REQ-20 | 20 | Template management overlay |
| REQ-21 | 20 | Template content preview |
| REQ-22 | 20 | Delete template from overlay |
| REQ-23 | 20 | Rename template |
| REQ-24 | 20 | Edit template content |
| REQ-25 | 20 | Template overlay keybinding (M) |
| REQ-26 | 21 | Schedule schema (migrations v4+v5) |
| REQ-27 | 21 | Schedule rule types (daily/weekdays/weekly/monthly) |
| REQ-28 | 21 | Schedule CRUD in store |
| REQ-29 | 22 | Schedule picker UI |
| REQ-30 | 22 | Schedule display in template list |
| REQ-31 | 22 | Auto-create on app launch |
| REQ-32 | 22 | Recurring todo visual indicator [R] |
| REQ-33 | 22 | Placeholder defaults at schedule creation |

**Coverage: 14/14 requirements shipped.**

## Phase Dependencies

```
Phase 20 (Template Overlay) --> Phase 21 (Schedule Schema) --> Phase 22 (Auto-Creation + UI)
```

## Milestone Summary

**Key Decisions:**
- Template content shown as raw text in overlay (not glamour-rendered) to reveal placeholder syntax
- UpdateTemplate returns error for UNIQUE constraint handling in rename UI
- tmplmgr overlay follows established package pattern (search, settings, preview)
- validDays map for bidirectional day name lookup and validation in recurring package
- lastDayOfMonth helper using Go time.Date day-0 trick for monthly clamping
- Schedule CadenceType/CadenceValue as flexible strings (weekly/monday, monthly/1, daily/empty)
- PlaceholderDefaults stored as JSON string for arbitrary key-value pairs
- AddScheduledTodo uses date as both display date and schedule_date dedup key
- Placeholder defaults prompting intercepts schedule confirm before save

**Issues Resolved:**
- Plan 22-03 exceeded context budget â€” split into 22-03 (schedule picker) and 22-04 (placeholder defaults)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- JSON Store schedule methods are stubs (return error/nil/no-op)

---

_For current project status, see .planning/ROADMAP.md_

---
phase: 05-todo-editing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/store/store.go
  - internal/todolist/keys.go
autonomous: true

must_haves:
  truths:
    - "Store has Update method that modifies a todo's text and date in place and persists"
    - "Store has Find method that returns a todo by ID"
    - "KeyMap has Edit (e) and EditDate (E) bindings with help text"
  artifacts:
    - path: "internal/store/store.go"
      provides: "Update and Find methods"
      contains: "func (s *Store) Update"
    - path: "internal/store/store.go"
      provides: "Find method returning pointer to todo"
      contains: "func (s *Store) Find"
    - path: "internal/todolist/keys.go"
      provides: "Edit and EditDate key bindings"
      contains: "Edit"
  key_links:
    - from: "internal/store/store.go Update"
      to: "store.Save()"
      via: "atomic persistence after update"
      pattern: "s\\.Save\\(\\)"
    - from: "internal/todolist/keys.go"
      to: "DefaultKeyMap"
      via: "Edit and EditDate fields initialized"
      pattern: "Edit.*key\\.NewBinding"
---

<objective>
Add store Update/Find methods and edit key bindings as foundation for todo editing.

Purpose: These are the building blocks that the edit mode handlers (Plan 02) will consume. The store needs Update (modify text+date in place) and Find (look up todo by ID to get the non-edited field). The KeyMap needs Edit (e) and EditDate (E) bindings.
Output: Modified store.go with Update+Find methods, modified keys.go with Edit+EditDate bindings.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-todo-editing/05-RESEARCH.md

@internal/store/store.go
@internal/todolist/keys.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Update and Find methods to store</name>
  <files>internal/store/store.go</files>
  <action>
Add two new methods to Store, following the exact pattern of Toggle and Delete:

1. `Find(id int) *Todo` -- iterates s.data.Todos, returns pointer to todo with matching ID, or nil if not found. Does NOT call Save (read-only lookup).

2. `Update(id int, text string, date string)` -- iterates s.data.Todos, finds matching ID, sets Text=text and Date=date on the found todo, then calls s.Save(). Date="" means floating (no date). If ID not found, does nothing (same pattern as Toggle/Delete).

Place these methods after Delete and before Todos, keeping the file organized: mutation methods together (Add, Toggle, Delete, Update, Find), then query methods (Todos, TodosForMonth, etc).
  </action>
  <verify>Run `cd /home/antti/Repos/Misc/todo-calendar && go build ./...` -- must compile with no errors.</verify>
  <done>Store has Update(id, text, date) that modifies in place and persists, and Find(id) that returns *Todo or nil.</done>
</task>

<task type="auto">
  <name>Task 2: Add Edit and EditDate key bindings</name>
  <files>internal/todolist/keys.go</files>
  <action>
Add two new fields to the KeyMap struct, placed after Delete and before Confirm:

```
Edit     key.Binding
EditDate key.Binding
```

In DefaultKeyMap(), add their initialization after the Delete binding:

```
Edit: key.NewBinding(
    key.WithKeys("e"),
    key.WithHelp("e", "edit"),
),
EditDate: key.NewBinding(
    key.WithKeys("E"),
    key.WithHelp("E", "edit date"),
),
```

Update ShortHelp() to include the new bindings in the returned slice, after Delete:
`return []key.Binding{k.Up, k.Down, k.Add, k.AddDated, k.Toggle, k.Delete, k.Edit, k.EditDate}`

Update FullHelp() similarly to include Edit and EditDate in the binding row.

This mirrors the a/A pattern (Add/AddDated) with e/E (Edit/EditDate).
  </action>
  <verify>Run `cd /home/antti/Repos/Misc/todo-calendar && go build ./...` -- must compile with no errors.</verify>
  <done>KeyMap has Edit ("e") and EditDate ("E") bindings with help text, included in ShortHelp and FullHelp returns.</done>
</task>

</tasks>

<verification>
1. `cd /home/antti/Repos/Misc/todo-calendar && go build ./...` compiles cleanly
2. `go vet ./...` reports no issues
3. Grep confirms new methods: `grep -n "func.*Store.*Update\|func.*Store.*Find" internal/store/store.go`
4. Grep confirms new bindings: `grep -n "Edit" internal/todolist/keys.go`
</verification>

<success_criteria>
- Store.Update(id, text, date) modifies todo in place and calls Save()
- Store.Find(id) returns *Todo or nil without side effects
- KeyMap has Edit ("e") and EditDate ("E") bindings
- ShortHelp and FullHelp include the new bindings
- Project compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-todo-editing/05-01-SUMMARY.md`
</output>

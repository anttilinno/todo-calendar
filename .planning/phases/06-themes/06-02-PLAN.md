---
phase: 06-themes
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - internal/calendar/styles.go
  - internal/calendar/grid.go
  - internal/calendar/model.go
  - internal/todolist/styles.go
  - internal/todolist/model.go
  - internal/app/styles.go
  - internal/app/model.go
  - main.go
autonomous: true

must_haves:
  truths:
    - "Setting theme=light in config.toml renders the app with light theme colors"
    - "Setting theme=nord renders the app with Nord palette colors"
    - "Setting theme=solarized renders the app with Solarized palette colors"
    - "Omitting theme from config.toml renders the app with Dark theme (matching current appearance)"
    - "All UI elements respect the selected theme: borders, calendar header, today highlight, holidays, indicators, section headers, cursor, completed todos, dates, empty placeholders, help bar"
  artifacts:
    - path: "internal/calendar/styles.go"
      provides: "Calendar Styles struct built from Theme"
      exports: ["Styles", "NewStyles"]
    - path: "internal/calendar/grid.go"
      provides: "RenderGrid accepting Styles parameter"
      contains: "func RenderGrid"
    - path: "internal/calendar/model.go"
      provides: "Calendar model storing Styles, constructor accepting Theme"
      contains: "styles Styles"
    - path: "internal/todolist/styles.go"
      provides: "Todolist Styles struct built from Theme"
      exports: ["Styles", "NewStyles"]
    - path: "internal/todolist/model.go"
      provides: "Todolist model storing Styles, constructor accepting Theme"
      contains: "styles Styles"
    - path: "internal/app/styles.go"
      provides: "App Styles struct built from Theme"
      contains: "func NewStyles"
    - path: "internal/app/model.go"
      provides: "App model storing Styles, constructor accepting Theme, help bar themed"
      contains: "theme.Theme"
    - path: "main.go"
      provides: "Theme loaded from config, passed to app.New"
      contains: "theme.ForName"
  key_links:
    - from: "main.go"
      to: "internal/app/model.go"
      via: "theme.ForName(cfg.Theme) passed to app.New()"
      pattern: "theme\\.ForName"
    - from: "internal/app/model.go"
      to: "internal/calendar/model.go"
      via: "Theme passed to calendar.New()"
      pattern: "calendar\\.New.*theme"
    - from: "internal/app/model.go"
      to: "internal/todolist/model.go"
      via: "Theme passed to todolist.New()"
      pattern: "todolist\\.New.*theme"
    - from: "internal/calendar/grid.go"
      to: "internal/calendar/styles.go"
      via: "RenderGrid receives Styles, uses s.Header, s.Today, etc."
      pattern: "s\\.(Header|Today|Holiday|Indicator|Normal|WeekdayHdr)"
    - from: "internal/app/model.go"
      to: "help.Styles"
      via: "help bar ShortKey/ShortDesc/ShortSeparator themed"
      pattern: "help\\.Styles\\.Short"
---

<objective>
Wire the Theme through the entire application: convert all three styles.go files from package-level vars to Styles structs, thread Theme through constructors from main.go to all child models, and theme the help bar.

Purpose: This is the integration plan that makes theming actually work. After this, changing `theme = "nord"` in config.toml changes the entire app's appearance.
Output: All 8 files modified, app compiles and runs with theme support.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-themes/06-RESEARCH.md
@.planning/phases/06-themes/06-01-SUMMARY.md
@internal/calendar/styles.go
@internal/calendar/grid.go
@internal/calendar/model.go
@internal/todolist/styles.go
@internal/todolist/model.go
@internal/app/styles.go
@internal/app/model.go
@main.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert calendar and todolist styles to Styles structs</name>
  <files>
    internal/calendar/styles.go
    internal/calendar/grid.go
    internal/calendar/model.go
    internal/todolist/styles.go
    internal/todolist/model.go
  </files>
  <action>
**Calendar package changes:**

1. `internal/calendar/styles.go` -- Replace package-level `var` block with a `Styles` struct and `NewStyles(t theme.Theme) Styles` constructor:
   ```go
   type Styles struct {
       Header     lipgloss.Style
       WeekdayHdr lipgloss.Style
       Normal     lipgloss.Style
       Today      lipgloss.Style
       Holiday    lipgloss.Style
       Indicator  lipgloss.Style
   }

   func NewStyles(t theme.Theme) Styles {
       return Styles{
           Header:     lipgloss.NewStyle().Bold(true).Foreground(t.HeaderFg),
           WeekdayHdr: lipgloss.NewStyle().Foreground(t.WeekdayFg),
           Normal:     lipgloss.NewStyle().Foreground(t.NormalFg),
           Today:      lipgloss.NewStyle().Bold(true).Foreground(t.TodayFg).Background(t.TodayBg),
           Holiday:    lipgloss.NewStyle().Foreground(t.HolidayFg),
           Indicator:  lipgloss.NewStyle().Bold(true).Foreground(t.IndicatorFg),
       }
   }
   ```
   IMPORTANT: Do NOT use `.Reverse(true)` on Today style. Use explicit Foreground/Background from theme. Do NOT use `.Faint(true)` on WeekdayHdr -- use explicit color instead. These are critical pitfalls from RESEARCH.md.

2. `internal/calendar/model.go` -- Add `styles Styles` field to Model struct. Update `New()` to accept `theme.Theme` parameter, call `NewStyles(t)` and store result. Signature becomes: `func New(provider *holidays.Provider, mondayStart bool, s *store.Store, t theme.Theme) Model`.

3. `internal/calendar/grid.go` -- Change `RenderGrid` to accept a `Styles` parameter: `func RenderGrid(year int, month time.Month, today int, holidays map[int]bool, mondayStart bool, indicators map[int]int, s Styles) string`. Replace all bare style references (`headerStyle`, `todayStyle`, etc.) with `s.Header`, `s.Today`, etc. Update the call in `model.go View()` to pass `m.styles`.

**Todolist package changes:**

4. `internal/todolist/styles.go` -- Replace package-level `var` block with a `Styles` struct and `NewStyles(t theme.Theme) Styles` constructor:
   ```go
   type Styles struct {
       SectionHeader lipgloss.Style
       Completed     lipgloss.Style
       Cursor        lipgloss.Style
       Date          lipgloss.Style
       Empty         lipgloss.Style
   }

   func NewStyles(t theme.Theme) Styles {
       return Styles{
           SectionHeader: lipgloss.NewStyle().Bold(true).Foreground(t.AccentFg),
           Completed:     lipgloss.NewStyle().Strikethrough(true).Foreground(t.CompletedFg),
           Cursor:        lipgloss.NewStyle().Foreground(t.AccentFg),
           Date:          lipgloss.NewStyle().Foreground(t.MutedFg),
           Empty:         lipgloss.NewStyle().Foreground(t.EmptyFg),
       }
   }
   ```
   IMPORTANT: Do NOT use `.Faint(true)` on Completed or Empty. Use explicit foreground color from theme instead. Faint becomes invisible on light backgrounds.

5. `internal/todolist/model.go` -- Add `styles Styles` field to Model struct. Update `New()` to accept `theme.Theme` parameter: `func New(s *store.Store, t theme.Theme) Model`. Call `NewStyles(t)` and store. Update `View()` and `renderTodo()` to use `m.styles.SectionHeader`, `m.styles.Cursor`, `m.styles.Completed`, `m.styles.Date`, `m.styles.Empty` instead of the old package-level var names.
  </action>
  <verify>Run `cd /home/antti/Repos/Misc/todo-calendar && go build ./internal/calendar/ && go build ./internal/todolist/` -- both must compile. Run `go vet ./internal/calendar/ ./internal/todolist/` -- no issues.</verify>
  <done>Calendar and todolist packages have Styles structs built from Theme. No package-level style vars remain. Both packages compile with new constructors.</done>
</task>

<task type="auto">
  <name>Task 2: Wire theme through app layer and main.go, theme help bar</name>
  <files>
    internal/app/styles.go
    internal/app/model.go
    main.go
  </files>
  <action>
1. `internal/app/styles.go` -- Replace package-level `var` block with a `Styles` struct and `NewStyles(t theme.Theme) Styles` constructor:
   ```go
   type Styles struct {
       Focused   lipgloss.Style
       Unfocused lipgloss.Style
   }

   func NewStyles(t theme.Theme) Styles {
       return Styles{
           Focused: lipgloss.NewStyle().
               Border(lipgloss.RoundedBorder()).
               BorderForeground(t.BorderFocused).
               Padding(0, 1),
           Unfocused: lipgloss.NewStyle().
               Border(lipgloss.RoundedBorder()).
               BorderForeground(t.BorderUnfocused).
               Padding(0, 1),
       }
   }
   ```
   Update or replace `paneStyle()` to be a method on Styles or accept Styles: simplest is `func (s Styles) Pane(focused bool) lipgloss.Style` or keep the free function but accept `Styles` as receiver/parameter.

2. `internal/app/model.go` -- Add `styles Styles` field to Model struct. Update `New()` signature to accept `theme.Theme`: `func New(provider *holidays.Provider, mondayStart bool, s *store.Store, t theme.Theme) Model`. Inside New():
   - Call `NewStyles(t)` for app styles
   - Pass `t` to `calendar.New(provider, mondayStart, s, t)`
   - Pass `t` to `todolist.New(s, t)`
   - Theme the help bar: after `help.New()`, set:
     ```go
     h := help.New()
     h.Styles.ShortKey = lipgloss.NewStyle().Foreground(t.AccentFg)
     h.Styles.ShortDesc = lipgloss.NewStyle().Foreground(t.MutedFg)
     h.Styles.ShortSeparator = lipgloss.NewStyle().Foreground(t.MutedFg)
     ```
   - Update `View()` to use `m.styles.Pane(focused)` (or equivalent) instead of the old `paneStyle(focused)`.

3. `main.go` -- Import `"github.com/antti/todo-calendar/internal/theme"`. After loading config, resolve theme: `t := theme.ForName(cfg.Theme)`. Pass to app: `model := app.New(provider, cfg.MondayStart(), s, t)`.
  </action>
  <verify>Run `cd /home/antti/Repos/Misc/todo-calendar && go build .` -- full app must compile. Run `go vet ./...` -- no issues across all packages.</verify>
  <done>Full app compiles. main.go loads theme from config and passes it through. All styles use theme colors. Help bar is themed. The app renders identically to before when theme is "dark" (or unset). Setting theme="nord" in config.toml changes all colors.</done>
</task>

</tasks>

<verification>
```bash
cd /home/antti/Repos/Misc/todo-calendar

# Full compilation
go build .

# Vet all packages
go vet ./...

# Verify no package-level style vars remain
grep -rn "^var.*Style\s*=" internal/calendar/styles.go internal/todolist/styles.go internal/app/styles.go
# Expected: no output (all converted to Styles struct)

# Verify theme is wired from main
grep -n "theme.ForName" main.go
# Expected: one match

# Verify no .Reverse(true) on today style
grep -n "Reverse" internal/calendar/styles.go
# Expected: no output

# Verify no .Faint(true) without explicit foreground
grep -n "Faint(true)" internal/todolist/styles.go internal/calendar/styles.go
# Expected: no output
```
</verification>

<success_criteria>
- `go build .` succeeds with zero errors
- `go vet ./...` passes clean
- No package-level `var` style declarations remain in any styles.go
- No `.Reverse(true)` in calendar today style
- No `.Faint(true)` without explicit foreground color
- Theme flows: main.go -> app.New -> calendar.New + todolist.New
- Help bar uses theme colors (AccentFg for keys, MutedFg for descriptions)
- Setting `theme = "nord"` in config.toml changes all app colors
- Omitting theme from config defaults to Dark (current appearance preserved)
</success_criteria>

<output>
After completion, create `.planning/phases/06-themes/06-02-SUMMARY.md`
</output>

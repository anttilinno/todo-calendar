---
phase: 19-pre-built-templates
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/store/seed.go
  - internal/store/sqlite.go
  - internal/store/sqlite_test.go
autonomous: true

must_haves:
  truths:
    - "First launch with empty DB seeds exactly 7 templates (3 general + 4 dev)"
    - "General templates include Meeting Notes, Checklist, and Daily Plan"
    - "Dev templates include Bug Report, Feature Spec, PR Checklist, and Code Review"
    - "Each template has valid placeholder syntax that ExtractPlaceholders can parse"
    - "Each template has 0-3 placeholders (not tedious to fill out)"
    - "Reopening an existing DB does not duplicate or re-seed templates"
    - "User can delete any seeded template permanently -- it never returns"
  artifacts:
    - path: "internal/store/seed.go"
      provides: "Template content constants and defaultTemplates() function"
      contains: "func defaultTemplates"
    - path: "internal/store/sqlite.go"
      provides: "Version 3 migration that seeds templates"
      contains: "version < 3"
    - path: "internal/store/sqlite_test.go"
      provides: "Tests for seeding, idempotency, and permanent deletion"
      contains: "TestSeedTemplates"
  key_links:
    - from: "internal/store/sqlite.go"
      to: "internal/store/seed.go"
      via: "migrate() calls defaultTemplates()"
      pattern: "defaultTemplates\\(\\)"
    - from: "internal/store/seed.go"
      to: "internal/tmpl/tmpl.go"
      via: "templates must use valid {{.Placeholder}} syntax parseable by ExtractPlaceholders"
      pattern: "\\{\\{\\.[A-Z]"
---

<objective>
Seed 7 pre-built markdown templates (3 general + 4 dev) on first launch via a version-3 SQLite migration.

Purpose: Users get useful templates out of the box without creating their own, making the template feature immediately discoverable and valuable.
Output: seed.go with template content, updated migrate() in sqlite.go, and sqlite_test.go with seeding tests.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-pre-built-templates/19-RESEARCH.md
@internal/store/sqlite.go
@internal/store/todo.go
@internal/tmpl/tmpl.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create seed templates and version-3 migration</name>
  <files>internal/store/seed.go, internal/store/sqlite.go</files>
  <action>
Create `internal/store/seed.go` with:

1. A `defaultTemplate` struct with `Name` and `Content` string fields (unexported type, only used internally).

2. A `defaultTemplates()` function returning `[]defaultTemplate` with exactly 7 templates:

**General templates (3):**

- "Meeting Notes" (2 placeholders: Topic, Date):
```
## {{.Topic}}

**Date:** {{.Date}}
**Attendees:**

### Agenda
-

### Notes
-

### Action Items
- [ ]
```

- "Checklist" (1 placeholder: Title):
```
## {{.Title}}

- [ ]
- [ ]
- [ ]
- [ ]
- [ ]
```

- "Daily Plan" (0 placeholders):
```
## Daily Plan

### Top Priorities
1.
2.
3.

### Tasks
- [ ]
- [ ]
- [ ]

### Notes
```

**Dev templates (4):**

- "Bug Report" (2 placeholders: Summary, Component):
```
## Bug: {{.Summary}}

**Component:** {{.Component}}

### Steps to Reproduce
1.
2.
3.

### Expected Behavior


### Actual Behavior


### Environment
- OS:
- Version:
```

- "Feature Spec" (1 placeholder: Name):
```
## Feature: {{.Name}}

### Problem
What problem does this solve?

### Solution
How should it work?

### Acceptance Criteria
- [ ]
- [ ]
- [ ]

### Notes
```

- "PR Checklist" (1 placeholder: Title):
```
## PR: {{.Title}}

### Changes
-

### Checklist
- [ ] Tests added/updated
- [ ] Documentation updated
- [ ] No breaking changes
- [ ] Self-reviewed code

### Testing
How was this tested?
```

- "Code Review" (2 placeholders: PR, Author):
```
## Review: {{.PR}}

**Author:** {{.Author}}

### Summary


### Feedback
-

### Approval
- [ ] Code quality
- [ ] Test coverage
- [ ] Documentation
```

3. In `internal/store/sqlite.go`, add a version-3 migration block in the `migrate()` function, immediately after the existing `version < 2` block (before the final `return nil`):

```go
if version < 3 {
    for _, t := range defaultTemplates() {
        s.db.Exec(
            "INSERT OR IGNORE INTO templates (name, content, created_at) VALUES (?, ?, ?)",
            t.Name, t.Content, time.Now().Format(dateFormat),
        )
    }
    if _, err := s.db.Exec("PRAGMA user_version = 3"); err != nil {
        return fmt.Errorf("set user_version: %w", err)
    }
}
```

Key points:
- `INSERT OR IGNORE` handles the UNIQUE constraint on name -- if a user already has a template with the same name, it silently skips.
- `PRAGMA user_version = 3` ensures this runs exactly once per database, not on every startup.
- No error checking on individual INSERT OR IGNORE -- matching the existing pattern where non-critical DB ops don't check errors.
  </action>
  <verify>
Run `go build ./...` to confirm compilation. Run `go vet ./...` for static analysis. Visually confirm seed.go has exactly 7 templates and sqlite.go has the version < 3 block.
  </verify>
  <done>
seed.go defines 7 templates (Meeting Notes, Checklist, Daily Plan, Bug Report, Feature Spec, PR Checklist, Code Review). sqlite.go migrate() includes version-3 block that seeds them with INSERT OR IGNORE and bumps user_version to 3.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add seed template tests</name>
  <files>internal/store/sqlite_test.go</files>
  <action>
Create `internal/store/sqlite_test.go` with the following tests. Import `testing`, `path/filepath`, and `github.com/anttiz/todo-calendar/internal/tmpl` (for ExtractPlaceholders validation).

**Test 1: TestSeedTemplates**
- Create a temp DB via `NewSQLiteStore(filepath.Join(t.TempDir(), "test.db"))`
- Call `ListTemplates()` and assert length is 7
- For each template, assert Name is non-empty, Content is non-empty
- For each template, call `tmpl.ExtractPlaceholders(t.Content)` and assert no error (validates placeholder syntax)
- Close store

**Test 2: TestSeedTemplates_Idempotent**
- Create store at temp path, list templates, record count, close
- Reopen same DB path, list templates, assert count unchanged
- Close store

**Test 3: TestSeedTemplates_DeletionPermanent**
- Create store at temp path
- List templates, delete ALL of them via `DeleteTemplate(t.ID)`
- Assert `ListTemplates()` returns empty slice (length 0)
- Close store
- Reopen same DB path
- Assert `ListTemplates()` still returns empty slice (length 0) -- deleted templates do NOT come back
- Close store

**Test 4: TestSeedTemplates_PlaceholderCounts**
- Create store at temp path
- List templates
- Build a map of name -> placeholder count by calling `tmpl.ExtractPlaceholders` for each
- Assert: "Meeting Notes" has 2, "Checklist" has 1, "Daily Plan" has 0, "Bug Report" has 2, "Feature Spec" has 1, "PR Checklist" has 1, "Code Review" has 2
- Close store

Use `t.Fatalf` for store creation errors, `t.Errorf` for assertion failures to allow multiple failures in one run.
  </action>
  <verify>
Run `go test ./internal/store/ -v` and confirm all 4 tests pass.
  </verify>
  <done>
All 4 tests pass: seeding produces 7 templates with valid placeholders, reopening doesn't duplicate, deletion is permanent across restarts, and placeholder counts match expectations.
  </done>
</task>

</tasks>

<verification>
1. `go build ./...` -- project compiles
2. `go vet ./...` -- no static analysis issues
3. `go test ./internal/store/ -v` -- all 4 seed tests pass
4. `go test ./... ` -- full test suite passes (no regressions)
</verification>

<success_criteria>
- A fresh SQLiteStore (new DB) automatically contains exactly 7 templates
- Templates cover general use (Meeting Notes, Checklist, Daily Plan) and dev use (Bug Report, Feature Spec, PR Checklist, Code Review)
- All template placeholders use valid {{.PascalCase}} syntax
- No template has more than 3 placeholders
- Reopening an existing database does not duplicate templates
- Deleting all templates and reopening does NOT re-seed them
- All tests pass, project builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/19-pre-built-templates/19-01-SUMMARY.md`
</output>

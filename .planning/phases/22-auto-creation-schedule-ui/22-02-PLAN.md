---
phase: 22-auto-creation-schedule-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/todolist/model.go
  - internal/todolist/styles.go
  - internal/tmplmgr/model.go
  - internal/tmplmgr/styles.go
autonomous: true

must_haves:
  truths:
    - "Auto-created todos show [R] indicator after todo text in muted color"
    - "Templates with schedules show dimmed cadence suffix in overlay list"
    - "Templates without schedules show no suffix"
  artifacts:
    - path: "internal/todolist/model.go"
      provides: "[R] indicator rendering in renderTodo"
      contains: "[R]"
    - path: "internal/todolist/styles.go"
      provides: "RecurringIndicator style"
      contains: "RecurringIndicator"
    - path: "internal/tmplmgr/model.go"
      provides: "Schedule suffix in template list View"
      contains: "scheduleLabel"
    - path: "internal/tmplmgr/styles.go"
      provides: "ScheduleSuffix style"
      contains: "ScheduleSuffix"
  key_links:
    - from: "internal/todolist/model.go"
      to: "store.Todo.ScheduleID"
      via: "check ScheduleID > 0"
      pattern: "ScheduleID"
    - from: "internal/tmplmgr/model.go"
      to: "store.TodoStore.ListSchedulesForTemplate"
      via: "look up schedules for display"
      pattern: "ListSchedulesForTemplate"
---

<objective>
Add visual indicators for recurring content: [R] on auto-created todos and schedule cadence suffix on templates in the overlay.

Purpose: REQ-32 (recurring todo indicator) and REQ-30 (schedule display in template list). Users see at a glance which todos are recurring and which templates have schedules.
Output: Modified todolist rendering and tmplmgr View.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@internal/todolist/model.go
@internal/todolist/styles.go
@internal/tmplmgr/model.go
@internal/tmplmgr/styles.go
@internal/store/todo.go
@internal/store/store.go
@internal/recurring/rule.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: [R] recurring indicator on todos</name>
  <files>internal/todolist/model.go, internal/todolist/styles.go</files>
  <action>
    In internal/todolist/styles.go:
    - Add `RecurringIndicator lipgloss.Style` to the Styles struct
    - In NewStyles(), set it to `lipgloss.NewStyle().Foreground(t.MutedFg)` (same color as BodyIndicator per REQ-32 "muted color")

    In internal/todolist/model.go renderTodo() (around line 1062, after the [+] body indicator block):
    - After the body indicator check, add a recurring indicator check:
      ```
      if t.ScheduleID > 0 {
          b.WriteString(" " + m.styles.RecurringIndicator.Render("[R]"))
      }
      ```
    - This goes AFTER the [+] body indicator and BEFORE the date. Order: text, [+], [R], date.
  </action>
  <verify>`cd /home/antti/Repos/Misc/todo-calendar && go build ./...` compiles. Grep for `RecurringIndicator` in both files.</verify>
  <done>Todos with ScheduleID > 0 display " [R]" in muted color after text (and after [+] if present), before the date.</done>
</task>

<task type="auto">
  <name>Task 2: Schedule cadence suffix in template overlay list</name>
  <files>internal/tmplmgr/model.go, internal/tmplmgr/styles.go</files>
  <action>
    In internal/tmplmgr/styles.go:
    - Add `ScheduleSuffix lipgloss.Style` to the Styles struct
    - In NewStyles(), set it to `lipgloss.NewStyle().Foreground(t.MutedFg)` (dimmed per REQ-30)

    In internal/tmplmgr/model.go:
    - Import "fmt", "strings" (strings already imported), and the recurring package ("github.com/antti/todo-calendar/internal/recurring")
    - Add a helper method `func (m Model) scheduleLabel(templateID int) string` that:
      1. Calls `m.store.ListSchedulesForTemplate(templateID)` to get schedules
      2. If no schedules, return ""
      3. Take the first schedule (a template has at most one schedule in practice)
      4. Build the rule string: if CadenceValue is empty, use CadenceType alone; otherwise CadenceType + ":" + CadenceValue
      5. Parse with recurring.ParseRule to get a ScheduleRule
      6. Format display label based on rule.Type:
         - "daily" -> "(daily)"
         - "weekdays" -> "(weekdays)"
         - "weekly" -> format days: capitalize first letter of each day, join with "/" -> "(Mon/Wed/Fri)"
         - "monthly" -> format as ordinal suffix: "(1st of month)", "(2nd of month)", "(3rd of month)", "(15th of month)" etc.
      7. If ParseRule fails, fall back to "(" + schedule.CadenceType + ")"
      8. Return the formatted string

    - Add a helper `func ordinalSuffix(n int) string` that returns "st", "nd", "rd", or "th" following standard English rules (1st, 2nd, 3rd, 4th-20th, 21st, 22nd, 23rd, 24th-30th, 31st).

    - In View(), in the template list rendering loop (around line 235-249), modify both the selected and non-selected branches:
      - After building the template name line, compute `suffix := m.scheduleLabel(t.ID)`
      - If suffix is not empty, append it styled with m.styles.ScheduleSuffix: `line += " " + m.styles.ScheduleSuffix.Render(suffix)`
      - For the selected line (cursor), apply SelectedName style to the ">" + name part, then append the styled suffix OUTSIDE the SelectedName style so it remains dimmed
      - For non-selected lines, apply TemplateName style to name part, append styled suffix

    The hint bar at the bottom does NOT change in this task (schedule key "s" is added in Plan 03).
  </action>
  <verify>`cd /home/antti/Repos/Misc/todo-calendar && go build ./...` compiles. `grep -n "scheduleLabel\|ScheduleSuffix\|ordinalSuffix" internal/tmplmgr/model.go internal/tmplmgr/styles.go` shows all additions.</verify>
  <done>Templates with schedules show a dimmed suffix like "(daily)", "(Mon/Wed/Fri)", "(15th of month)" in the overlay list. Templates without schedules show no suffix.</done>
</task>

</tasks>

<verification>
- `cd /home/antti/Repos/Misc/todo-calendar && go build ./...` compiles with no errors
- `cd /home/antti/Repos/Misc/todo-calendar && go test ./...` all tests pass
- `grep -n '\[R\]' internal/todolist/model.go` shows recurring indicator rendering
- `grep -n 'scheduleLabel' internal/tmplmgr/model.go` shows schedule suffix logic
</verification>

<success_criteria>
- [R] indicator appears after todo text for todos with ScheduleID > 0, styled in MutedFg
- Schedule cadence suffix appears dimmed next to template names in overlay
- All four cadence types display correctly: daily, weekdays, weekly days, monthly ordinal
- No suffix shown for templates without schedules
- Build passes, all existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/22-auto-creation-schedule-ui/22-02-SUMMARY.md`
</output>

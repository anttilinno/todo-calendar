---
phase: 23-cleanup-calendar-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/store/store.go
  - internal/store/iface.go
  - internal/store/todo.go
  - internal/calendar/grid.go
  - internal/calendar/styles.go
autonomous: true

must_haves:
  truths:
    - "JSON store implementation code is completely removed from the codebase"
    - "TodoStore interface remains intact and accessible to all consumers"
    - "Today's calendar date shows blended today+pending (yellow) or today+done (green) styling"
    - "Non-today dates still show standard indicator or done styling as before"
    - "Application builds and runs without errors"
  artifacts:
    - path: "internal/store/iface.go"
      provides: "TodoStore interface, MonthCount, FloatingCount types"
      contains: "type TodoStore interface"
    - path: "internal/store/store.go"
      provides: "Nothing (file deleted)"
    - path: "internal/calendar/styles.go"
      provides: "TodayIndicator and TodayDone styles for blended rendering"
      contains: "TodayIndicator"
    - path: "internal/calendar/grid.go"
      provides: "Updated style priority: today+indicator > today > holiday > indicator > done > normal"
      contains: "TodayIndicator"
  key_links:
    - from: "internal/calendar/grid.go"
      to: "internal/calendar/styles.go"
      via: "s.TodayIndicator and s.TodayDone style usage"
      pattern: "s\\.Today(Indicator|Done)"
    - from: "internal/calendar/styles.go"
      to: "internal/theme/theme.go"
      via: "Theme color fields for blended styles"
      pattern: "t\\.Today(Fg|Bg)|t\\.IndicatorFg|t\\.CompletedCountFg"
---

<objective>
Remove the unused JSON store implementation and make today's calendar date blend with todo indicator status.

Purpose: Eliminate dead code (CLN-01) and fix the today indicator to show pending/done coloring (CAL-01) so users can see at a glance whether today has outstanding or completed todos.
Output: Cleaner store package (interface extracted, JSON impl deleted) and blended today+indicator calendar cells.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@internal/store/store.go
@internal/store/todo.go
@internal/store/sqlite.go
@internal/calendar/grid.go
@internal/calendar/styles.go
@internal/theme/theme.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract TodoStore interface and remove JSON store</name>
  <files>internal/store/iface.go, internal/store/store.go, internal/store/todo.go</files>
  <action>
1. Create `internal/store/iface.go` containing:
   - The `TodoStore` interface (copy from store.go lines 15-46)
   - The `MonthCount` struct and `FloatingCount` struct (move from store.go lines 327-332, 374-377)
   - Package declaration and necessary imports (just `time`)

2. Remove `internal/store/todo.go` lines 46-50: the `Data` struct (JSON envelope). This struct is only used by the JSON store. Keep everything else in todo.go (Todo, Template, Schedule types, dateFormat const, methods).

3. Delete `internal/store/store.go` entirely. This file contains:
   - The JSON `Store` struct and all its methods (Add, Toggle, Delete, Find, Update, etc.)
   - The `TodosPath()` function
   - The compile-time check `var _ TodoStore = (*Store)(nil)`
   - All the stub template/schedule methods

   All of this is dead code -- main.go uses `NewSQLiteStore` exclusively.

4. Verify that `internal/store/sqlite.go` already has its own compile-time check (`var _ TodoStore = (*SQLiteStore)(nil)`). If not, add one.

5. Run `go build ./...` to confirm no compilation errors.
  </action>
  <verify>
- `go build ./...` succeeds
- `grep -r "NewStore\b" internal/` returns no matches (JSON store constructor gone)
- `grep -r "TodosPath" internal/` returns no matches
- `grep -r "type Data struct" internal/` returns no matches
- `grep -r "TodoStore" internal/store/iface.go` confirms interface exists
- `go vet ./...` passes
  </verify>
  <done>JSON store implementation is fully removed. TodoStore interface, MonthCount, FloatingCount, and all shared types remain in the store package. Application compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Blend today highlight with indicator status</name>
  <files>internal/calendar/styles.go, internal/calendar/grid.go</files>
  <action>
1. In `internal/calendar/styles.go`:
   - Add two new fields to the `Styles` struct:
     - `TodayIndicator lipgloss.Style` (today + pending todos = bold, indicator foreground color, today background)
     - `TodayDone lipgloss.Style` (today + all done = bold, completed count foreground color, today background)
   - In `NewStyles()`, initialize these:
     - `TodayIndicator`: Bold(true), Foreground(t.IndicatorFg), Background(t.TodayBg)
     - `TodayDone`: Bold(true), Foreground(t.CompletedCountFg), Background(t.TodayBg)

   The blending strategy: keep the today background highlight but use the indicator/done foreground color instead of the plain today foreground. This makes today visually distinct while communicating todo status through color.

   Special case for Dark theme: TodayBg is empty string (terminal default). The blended styles will still work -- the foreground color alone (yellow for pending, green for done) communicates status, and the bold attribute distinguishes today from non-today indicators.

2. In `internal/calendar/grid.go`, update the `RenderGrid` function's style priority switch (around line 82):
   Change from: `today > holiday > indicator > done > normal`
   Change to: `today+indicator > today+done > today > holiday > indicator > done > normal`

   Replace the existing switch block with:
   ```go
   switch {
   case day == today && hasPending:
       cell = s.TodayIndicator.Render(cell)
   case day == today && hasAllDone:
       cell = s.TodayDone.Render(cell)
   case day == today:
       cell = s.Today.Render(cell)
   case holidays[day]:
       cell = s.Holiday.Render(cell)
   case hasPending:
       cell = s.Indicator.Render(cell)
   case hasAllDone:
       cell = s.IndicatorDone.Render(cell)
   default:
       cell = s.Normal.Render(cell)
   }
   ```

3. Apply the same change to `RenderWeekGrid` (around line 226). The switch block there has the same structure but uses `isToday` instead of `day == today` and `hols[dd]` instead of `holidays[day]`:
   ```go
   switch {
   case isToday && hasPending:
       cell = s.TodayIndicator.Render(cell)
   case isToday && hasAllDone:
       cell = s.TodayDone.Render(cell)
   case isToday:
       cell = s.Today.Render(cell)
   case hols[dd]:
       cell = s.Holiday.Render(cell)
   case hasPending:
       cell = s.Indicator.Render(cell)
   case hasAllDone:
       cell = s.IndicatorDone.Render(cell)
   default:
       cell = s.Normal.Render(cell)
   }
   ```

4. Run `go build ./...` and `go vet ./...` to confirm.
  </action>
  <verify>
- `go build ./...` succeeds
- `go vet ./...` passes
- `grep "TodayIndicator" internal/calendar/styles.go` shows struct field and initialization
- `grep "TodayDone" internal/calendar/styles.go` shows struct field and initialization
- `grep "TodayIndicator" internal/calendar/grid.go` shows usage in both RenderGrid and RenderWeekGrid
  </verify>
  <done>Today's calendar date now shows blended styling: yellow-on-today-bg when pending todos exist, green-on-today-bg when all todos are done, plain today highlight when no todos exist. Both monthly and weekly grid views updated.</done>
</task>

</tasks>

<verification>
- `go build ./...` -- entire project compiles
- `go vet ./...` -- no issues
- `go test ./...` -- all tests pass
- `grep -r "store.Store\b" --include="*.go" .` returns nothing (JSON Store type gone)
- `grep -r "store.Data\b" --include="*.go" .` returns nothing (Data type gone)
- `grep "TodayIndicator\|TodayDone" internal/calendar/grid.go` shows blended style usage in both grid renderers
</verification>

<success_criteria>
1. JSON store implementation is completely removed; TodoStore interface remains
2. Today calendar cells show pending (indicator fg) or done (completed fg) colors blended with the today background
3. All existing tests pass and project builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/23-cleanup-calendar-polish/23-01-SUMMARY.md`
</output>

---
phase: 23-cleanup-calendar-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/todolist/keys.go
  - internal/todolist/model.go
autonomous: true

must_haves:
  truths:
    - "Pressing A in normal mode does nothing (AddDated keybinding removed)"
    - "Pressing t in normal mode does nothing (TemplateUse keybinding removed)"
    - "Pressing T in normal mode still opens the template creation flow"
    - "Pressing a in normal mode still opens the add todo flow"
    - "Pressing e in normal mode still opens the edit flow with title+date+body fields"
    - "Application builds and all tests pass"
  artifacts:
    - path: "internal/todolist/keys.go"
      provides: "KeyMap without AddDated or TemplateUse"
    - path: "internal/todolist/model.go"
      provides: "Model without template-use flow, dated-add flow, or dateInputMode"
  key_links:
    - from: "internal/todolist/model.go"
      to: "internal/todolist/keys.go"
      via: "KeyMap field references in update handlers and help bindings"
      pattern: "m\\.keys\\."
---

<objective>
Remove the obsolete `A` (AddDated) and `t` (TemplateUse) key bindings and all associated dead code paths from the todolist package.

Purpose: Phase 24 will replace these with a unified `a` form. Removing them now prevents confusion and reduces code surface area (CLN-02).
Output: Cleaner todolist model with fewer modes and no dead input flows.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@internal/todolist/keys.go
@internal/todolist/model.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove AddDated and TemplateUse keybindings and dead code</name>
  <files>internal/todolist/keys.go, internal/todolist/model.go</files>
  <action>
This is a large cleanup. Work through it methodically in this order:

**Part A: keys.go**

1. Remove `AddDated key.Binding` field from the `KeyMap` struct.
2. Remove `TemplateUse key.Binding` field from the `KeyMap` struct.
3. Remove `k.AddDated` and `k.TemplateUse` from the `ShortHelp()` return slice.
4. Remove `k.AddDated` and `k.TemplateUse` from the `FullHelp()` return slice.
5. Remove the `AddDated` initialization block from `DefaultKeyMap()` (the `key.NewBinding` for "A").
6. Remove the `TemplateUse` initialization block from `DefaultKeyMap()` (the `key.NewBinding` for "t").

**Part B: model.go -- Remove dead modes**

7. Remove the `dateInputMode` constant from the mode enum. It is never assigned (dead since the AddDated flow was refactored to use inputMode+addingDated). Keep the comment numbering consistent.
8. Remove the `templateSelectMode` constant from the mode enum.
9. Remove the `placeholderInputMode` constant from the mode enum.
10. Update any remaining iota values if needed to keep the enum clean. The remaining modes should be: normalMode, inputMode, editMode, filterMode, templateNameMode, templateContentMode.

**Part C: model.go -- Remove dead fields from Model struct**

11. Remove `addingDated bool` field (no longer any separate dated-add entry point).
12. Remove `pendingText string` field (was used by dateInputMode, which is dead).
13. Remove `templates []store.Template` field (used only by templateSelectMode).
14. Remove `templateCursor int` field (used only by templateSelectMode).
15. Remove `pendingTemplate *store.Template` field (used only by template-use flow).
16. Remove `placeholderNames []string` field (used only by placeholderInputMode).
17. Remove `placeholderIndex int` field (used only by placeholderInputMode).
18. Remove `placeholderValues map[string]string` field (used only by placeholderInputMode).
19. Remove `pendingBody string` field (used only by template-use flow during add).
20. Remove `fromTemplate bool` field (used only by template-use flow during add).

**Part D: model.go -- Remove dead handler functions**

21. Remove the entire `updateDateInputMode` function (~35 lines). It was only reachable from dateInputMode which was never entered.
22. Remove the entire `updateTemplateSelectMode` function (~65 lines). It was only reachable from the `t` keybinding.
23. Remove the entire `updatePlaceholderInputMode` function (~30 lines). It was only reachable from templateSelectMode.

**Part E: model.go -- Clean up updateNormalMode**

24. Remove the `case key.Matches(msg, m.keys.AddDated):` block (lines ~402-412). This was the A key handler.
25. Remove the `case key.Matches(msg, m.keys.TemplateUse):` block (lines ~487-494). This was the t key handler.

**Part F: model.go -- Clean up HelpBindings and AllHelpBindings**

26. In `HelpBindings()`:
   - Remove the `case inputMode:` branch that checks `m.addingDated` -- simplify to always return `[]key.Binding{m.keys.Confirm, m.keys.Cancel}` for inputMode.
   - Remove the `case dateInputMode:` branch entirely.
   - Remove the `case templateSelectMode:` branch entirely.
27. In `AllHelpBindings()`:
   - Remove the `case inputMode:` branch that checks `m.addingDated` -- simplify to always return `[]key.Binding{m.keys.Confirm, m.keys.Cancel}` for inputMode.
   - Remove the `case dateInputMode:` branch entirely.
   - Remove `m.keys.AddDated` and `m.keys.TemplateUse` from the normalMode case.
   - Remove the `case templateSelectMode:` branch entirely.

**Part G: model.go -- Clean up Update() dispatch**

28. In the `Update()` method, remove the blink forwarding for `dateInputMode` in the mode switch (line ~306 area). The `case inputMode, dateInputMode, editMode:` should become `case inputMode, editMode:`.
29. In the key dispatch switch, remove `case dateInputMode:` (line ~332), `case templateSelectMode:` (line ~338), and `case placeholderInputMode:` (line ~340).

**Part H: model.go -- Clean up updateInputMode**

30. Remove all `m.addingDated` branches from `updateInputMode`:
   - In the Confirm handler: remove the `if m.addingDated { ... }` block (lines ~539-570). Keep only the simple add flow (lines ~572-585).
   - In the SwitchField handler: remove the `if m.addingDated { ... }` block (lines ~588-597). SwitchField in inputMode can just return m, nil.
   - At the bottom: remove the `if m.addingDated && m.editField == 1` branch (lines ~614-616). Keep only the `m.input, cmd = m.input.Update(msg)` path.
31. Remove all `m.fromTemplate` checks from updateInputMode:
   - After the Add call in Confirm handler, remove the `if m.fromTemplate { ... }` block.
32. In the Cancel handler, remove the `m.clearTemplateState()` call and the `m.dateInput.Blur()`, `m.dateInput.SetValue("")`, `m.editField = 0` cleanup (those were for addingDated).

**Part I: model.go -- Clean up editView**

33. In `editView()`:
   - Remove the `case templateSelectMode:` rendering block (~lines 985-999).
   - Remove the `case placeholderInputMode:` rendering block (~lines 1011-1015).
   - In the `case inputMode:` block, remove the `if m.addingDated` branch (lines ~1018-1027). Keep only the single-field title rendering.
   - Remove `dateInputMode` from the switch in View() (~line 938) and any rendering in editView's default case that references dateInputMode.

**Part J: model.go -- Simplify clearTemplateState**

34. `clearTemplateState` is still called from `updateTemplateNameMode` and `updateTemplateContentMode` (the `T` TemplateCreate flow). Simplify it to only reset fields that still exist:
    ```go
    func (m *Model) clearTemplateState() {
        m.pendingTemplateName = ""
    }
    ```
    All other fields it used to reset have been removed from the Model struct.

**Part K: Final cleanup**

35. Remove any unused imports that result from the changes (e.g., if `store` is no longer needed in certain places, though it likely still is for the template list in TemplateCreate).
36. Verify the `tmpl` import is still needed (it's used in updateTemplateSelectMode which is removed, but check if anything else uses it). If `tmpl` is only used by the removed template-use flow, remove the import. Actually, `tmpl` is used for template creation too -- check `updateTemplateContentMode` and keep if needed.

Run `go build ./...` and `go vet ./...` after all changes.
  </action>
  <verify>
- `go build ./...` succeeds
- `go vet ./...` passes
- `go test ./...` passes
- `grep "AddDated" internal/todolist/keys.go` returns nothing
- `grep "TemplateUse" internal/todolist/keys.go` returns nothing
- `grep "AddDated\|TemplateUse" internal/todolist/model.go` returns nothing
- `grep "dateInputMode" internal/todolist/model.go` returns nothing
- `grep "templateSelectMode" internal/todolist/model.go` returns nothing
- `grep "placeholderInputMode" internal/todolist/model.go` returns nothing
- `grep "addingDated" internal/todolist/model.go` returns nothing
- `grep "fromTemplate" internal/todolist/model.go` returns nothing
- `grep "TemplateCreate" internal/todolist/keys.go` returns a match (T key preserved)
- `grep "templateNameMode\|templateContentMode" internal/todolist/model.go` returns matches (T key flow preserved)
  </verify>
  <done>The `A` (AddDated) and `t` (TemplateUse) key bindings are fully removed along with all dead code paths they triggered: dateInputMode, templateSelectMode, placeholderInputMode, addingDated branches, fromTemplate branches, and associated Model fields. The `T` (TemplateCreate), `a` (Add), and `e` (Edit) flows remain intact. Application compiles and tests pass.</done>
</task>

</tasks>

<verification>
- `go build ./...` -- entire project compiles
- `go vet ./...` -- no issues
- `go test ./...` -- all tests pass
- No references to AddDated, TemplateUse, dateInputMode, templateSelectMode, placeholderInputMode, addingDated, or fromTemplate in the todolist package
- TemplateCreate (`T`) flow still works (templateNameMode + templateContentMode preserved)
- Add (`a`) flow still works (inputMode without addingDated)
- Edit (`e`) flow still works (editMode with title+date+body)
</verification>

<success_criteria>
1. Pressing `A` in normal mode has no effect
2. Pressing `t` in normal mode has no effect
3. Pressing `T` still opens template creation
4. Pressing `a` still opens todo add (floating)
5. Pressing `e` still opens edit with title+date+body
6. No dead code remains from the removed flows
7. Project builds and all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/23-cleanup-calendar-polish/23-02-SUMMARY.md`
</output>

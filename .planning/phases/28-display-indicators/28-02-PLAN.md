---
phase: 28-display-indicators
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/calendar/model.go
  - internal/calendar/grid.go
  - internal/calendar/styles.go
autonomous: true

must_haves:
  truths:
    - "Calendar displays a left circle indicator showing month-todo status (red=pending, green=all done)"
    - "Calendar displays a right circle indicator showing year-todo status (red=pending, green=all done)"
    - "Indicators only appear when relevant month/year todos exist"
    - "Indicators update when navigating months or years"
  artifacts:
    - path: "internal/calendar/grid.go"
      provides: "Circle indicator rendering on calendar title line"
      contains: "MonthTodos"
    - path: "internal/calendar/styles.go"
      provides: "FuzzyPending and FuzzyDone styles for circle indicators"
      contains: "FuzzyPending"
    - path: "internal/calendar/model.go"
      provides: "Store reference passed to RenderGrid for indicator queries"
  key_links:
    - from: "internal/calendar/grid.go"
      to: "store.MonthTodos"
      via: "query in RenderGrid"
      pattern: "MonthTodos"
    - from: "internal/calendar/grid.go"
      to: "store.YearTodos"
      via: "query in RenderGrid"
      pattern: "YearTodos"
---

<objective>
Add circle indicators to the calendar title line showing month-todo and year-todo status.

Purpose: Users can see at a glance whether they have pending fuzzy-date todos for the current month (left circle) and year (right circle). Red means pending todos exist, green means all are completed, absent means no fuzzy todos.

Output: Calendar grid renders "● February 2026 ●" with colored circles when fuzzy todos exist.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-date-precision-input/27-01-SUMMARY.md
@internal/calendar/model.go
@internal/calendar/grid.go
@internal/calendar/styles.go
@internal/store/iface.go
@internal/theme/theme.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add fuzzy indicator styles to calendar</name>
  <files>internal/calendar/styles.go</files>
  <action>
Add two new styles to the Styles struct for fuzzy-date circle indicators:

```go
FuzzyPending lipgloss.Style  // red circle for pending fuzzy todos
FuzzyDone    lipgloss.Style  // green circle for all-done fuzzy todos
```

In NewStyles, set them using existing theme roles:
- FuzzyPending: `lipgloss.NewStyle().Foreground(t.PendingFg)` (red family)
- FuzzyDone: `lipgloss.NewStyle().Foreground(t.CompletedCountFg)` (green family)

These reuse existing PendingFg and CompletedCountFg roles (already defined for all 4 themes) rather than adding new theme color roles. This follows the "no new theme roles unless semantically distinct" pattern from Phase 10.
  </action>
  <verify>`go build ./internal/calendar/...` compiles.</verify>
  <done>FuzzyPending and FuzzyDone styles exist in calendar.Styles, built from PendingFg and CompletedCountFg theme roles.</done>
</task>

<task type="auto">
  <name>Task 2: Render circle indicators on calendar title line</name>
  <files>internal/calendar/grid.go, internal/calendar/model.go</files>
  <action>
**In `grid.go` - Update `RenderGrid` signature and title rendering:**

1. Add a `store.TodoStore` parameter to RenderGrid: `func RenderGrid(year int, month time.Month, today int, holidays map[int]bool, mondayStart bool, indicators map[int]int, totals map[int]int, st store.TodoStore, s Styles) string`

2. After computing the title string ("February 2026"), determine circle indicators:
   - Query `st.MonthTodos(year, month)` to get month-precision todos for this month
   - Query `st.YearTodos(year)` to get year-precision todos for this year
   - For each set: if len > 0, check if any have `Done == false`
     - If any pending: render circle with `s.FuzzyPending.Render("●")`
     - If all done: render circle with `s.FuzzyDone.Render("●")`
     - If empty: no circle (render empty string or spaces to maintain alignment)

3. Build the title line with circles:
   - If month circle exists: `monthCircle + " " + title`; otherwise just `title`
   - If year circle exists: append `" " + yearCircle`
   - Compute padding for centering based on the visible width (title + circles + spaces)
   - The visible width of "●" is 1 character. Account for this in centering math.
   - IMPORTANT: Only count visible characters for centering, not ANSI escape codes. Use `lipgloss.Width()` on the composed string to get visible width, or pre-compute the visible character count (title length + 1 per circle + 1 space per circle).

4. Extract the circle computation into a helper function for clarity:
   ```go
   // fuzzyStatus returns "pending", "done", or "" based on whether any todos are incomplete.
   func fuzzyStatus(todos []store.Todo) string {
       if len(todos) == 0 {
           return ""
       }
       for _, t := range todos {
           if !t.Done {
               return "pending"
           }
       }
       return "done"
   }
   ```

5. **In `RenderWeekGrid`:** Do NOT add circle indicators. Weekly view excludes fuzzy todos (VIEW-01). No changes to RenderWeekGrid parameters.

**In `model.go` - Update RenderGrid call site:**

1. In `View()`, update the `RenderGrid` call to pass `m.store`:
   ```go
   grid := RenderGrid(m.year, m.month, todayDay, m.holidays, m.mondayStart, m.indicators, m.totals, m.store, m.styles)
   ```
  </action>
  <verify>
Run `go build ./...` to confirm compilation.
Run `go test ./...` to confirm all existing tests pass.
Inspect the RenderGrid function to verify circle indicators are rendered on the title line with correct centering.
  </verify>
  <done>
Calendar title line shows "● February 2026 ●" with left circle for month-todo status and right circle for year-todo status.
Red circle (PendingFg) when pending todos exist, green circle (CompletedCountFg) when all done, no circle when no fuzzy todos.
Indicators update when navigating months/years via the existing RenderGrid call.
Weekly view grid does not show circle indicators.
  </done>
</task>

</tasks>

<verification>
- `go build ./...` passes
- `go test ./...` passes
- Calendar title line renders circles when fuzzy todos exist for current month/year
- No circles when no fuzzy todos exist (INDIC-03)
- Red circle for pending, green for all done (INDIC-01, INDIC-02)
- Weekly view has no circles
</verification>

<success_criteria>
- Calendar shows left circle (month status) and right circle (year status) on the title line
- Colors match: red = pending, green = all done
- Indicators absent when no relevant fuzzy todos exist
- All 4 themes render correctly (PendingFg/CompletedCountFg already defined)
- Weekly view grid unaffected
- All tests pass, app compiles
</success_criteria>

<output>
After completion, create `.planning/phases/28-display-indicators/28-02-SUMMARY.md`
</output>

---
phase: 35-event-display-grid
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/google/events.go
  - internal/theme/theme.go
  - internal/todolist/styles.go
  - internal/config/config.go
autonomous: true

must_haves:
  truths:
    - "Multi-day all-day events can be expanded into per-day entries"
    - "Event foreground color exists in all 4 themes"
    - "GoogleCalendarEnabled config field defaults to true"
  artifacts:
    - path: "internal/google/events.go"
      provides: "EndDate field on CalendarEvent, ExpandMultiDay helper"
      contains: "EndDate"
    - path: "internal/theme/theme.go"
      provides: "EventFg color in Theme struct and all 4 theme functions"
      contains: "EventFg"
    - path: "internal/todolist/styles.go"
      provides: "EventTime and EventText styles"
      contains: "EventTime"
    - path: "internal/config/config.go"
      provides: "GoogleCalendarEnabled bool field with default true"
      contains: "GoogleCalendarEnabled"
  key_links:
    - from: "internal/todolist/styles.go"
      to: "internal/theme/theme.go"
      via: "EventFg used in NewStyles"
      pattern: "t\\.EventFg"
---

<objective>
Add the data layer foundations for event display: EndDate field for multi-day expansion, EventFg theme color, event styles, and GoogleCalendarEnabled config toggle.

Purpose: Provides the types, helpers, and styling infrastructure that Plans 02 and 03 need.
Output: Extended CalendarEvent type, ExpandMultiDay function, event styles in all themes, config toggle field.
</objective>

<execution_context>
@/home/antti/.claude/get-shit-done/workflows/execute-plan.md
@/home/antti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-event-display-grid/35-RESEARCH.md
@internal/google/events.go
@internal/theme/theme.go
@internal/todolist/styles.go
@internal/config/config.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add EndDate field and ExpandMultiDay helper to CalendarEvent</name>
  <files>internal/google/events.go</files>
  <action>
1. Add `EndDate string` field to CalendarEvent struct, with comment: `// "2006-01-02" end date for all-day events (exclusive, Google convention)`

2. In `convertEvent()`, after setting `ce.Date = e.Start.Date` for all-day events, also store end date:
   ```go
   if e.End != nil && e.End.Date != "" {
       ce.EndDate = e.End.Date
   }
   ```

3. Add `ExpandMultiDay(events []CalendarEvent) []CalendarEvent` function:
   - For each event: if not AllDay, or EndDate is empty, pass through unchanged
   - Parse Date and EndDate as "2006-01-02". If parse fails, pass through unchanged
   - If EndDate equals the day after Date (single-day event), pass through unchanged
   - Iterate from start date to end date EXCLUSIVE (`d.Before(end)`), creating a copy for each day with `expanded.Date = d.Format("2006-01-02")`
   - Return the collected results

This is needed for DISP-06 (multi-day events expanded to show on each day).
  </action>
  <verify>Run `go build ./internal/google/...` -- must compile without errors.</verify>
  <done>CalendarEvent has EndDate field populated by convertEvent for all-day events. ExpandMultiDay correctly expands multi-day events using exclusive end dates.</done>
</task>

<task type="auto">
  <name>Task 2: Add EventFg theme color, event styles, and GoogleCalendarEnabled config</name>
  <files>internal/theme/theme.go, internal/todolist/styles.go, internal/config/config.go</files>
  <action>
1. In `internal/theme/theme.go`:
   - Add `EventFg lipgloss.Color` field to Theme struct, with comment: `// calendar event text`
   - Set EventFg in all 4 themes using cyan/teal family (distinct from todo accent/muted):
     - Dark: `"#5FAFAF"` (teal, good contrast on dark bg)
     - Light: `"#00878A"` (dark teal, good contrast on light bg)
     - Nord: `"#8FBCBB"` (nord7 frost -- the lighter teal from Nord palette)
     - Solarized: `"#2AA198"` (solarized cyan -- the canonical cyan)

2. In `internal/todolist/styles.go`:
   - Add `EventTime lipgloss.Style` and `EventText lipgloss.Style` fields to Styles struct
   - In `NewStyles()`, initialize:
     - `EventTime: lipgloss.NewStyle().Foreground(t.EventFg).Bold(true)` (bold time prefix)
     - `EventText: lipgloss.NewStyle().Foreground(t.EventFg)` (event summary)

3. In `internal/config/config.go`:
   - Add `GoogleCalendarEnabled bool` field to Config struct with toml tag `toml:"google_calendar_enabled"`
   - In `DefaultConfig()`, set `GoogleCalendarEnabled: true` (existing users who connected should keep seeing events)
  </action>
  <verify>Run `go build ./...` -- must compile without errors. Verify with `go vet ./...`.</verify>
  <done>EventFg color defined in all 4 themes. EventTime and EventText styles created. GoogleCalendarEnabled defaults to true in config.</done>
</task>

</tasks>

<verification>
- `go build ./...` passes
- `go vet ./...` passes
- CalendarEvent struct has EndDate field
- Theme struct has EventFg field with colors in all 4 themes
- Styles struct has EventTime and EventText
- Config struct has GoogleCalendarEnabled defaulting to true
</verification>

<success_criteria>
All foundation types, helpers, and styles compile and are ready for consumption by Plans 02 and 03.
</success_criteria>

<output>
After completion, create `.planning/phases/35-event-display-grid/35-01-SUMMARY.md`
</output>
